"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[461],{3461:(E,f,a)=>{a.d(f,{d:()=>p});var d=a(5861),s=a(4006),h=a(3558),m=a(5412),_=a(5226),g=a.n(_),T=a(3185),Z=a(1135),P=a(7705),e=a(4650),C=a(8811),L=a(1481),A=a(4719),O=a(6682),v=a(6895),x=a(7392),b=a(9549),M=a(3238),y=a(4385),D=a(1014),I=a(8306),S=a(9836);const U=["panel"];function R(r,o){1&r&&(e.TgZ(0,"div",30),e._uU(1,"Registro de Paciente"),e.qZA())}function w(r,o){1&r&&(e.TgZ(0,"div",30),e._uU(1,"Actualizaci\xf3n de Paciente"),e.qZA())}function k(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"btn-actions",31),e.NdJ("buttonClick",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.getLocation())}),e.qZA()}2&r&&e.Q6J("color","orange")("label","Ir a la Direcci\xf3n")("icon","location_on")("withFull",!1)("disabled",!1)}function J(r,o){if(1&r&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function N(r,o){if(1&r&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function B(r,o){if(1&r&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}class p{constructor(o,t,n,i,c,l,u,j){this.activatedRoute=o,this.fb=t,this.router=n,this.sanitizer=i,this.service=c,this.geoService=l,this.dialogRef=j,this.panelOpenState=new Z.X(!1),this.center={lat:-17.783362,lng:-63.1847183},this.zoom=17,this.isModal=!1,this.panelExpanded=!1,this.id=null,this.imageSource=this.sanitizer.bypassSecurityTrustResourceUrl(T.O),this.currentLocation=null,this.isCreate=!1,this.isSaving=!1,this.listZone=[{id:1,name:"Santa Cruz"}],this.listDepartament=[{id:1,name:"Santa Cruz"},{id:2,name:"Beni"},{id:3,name:"Pando"},{id:4,name:"La Paz"},{id:5,name:"Cochabamba"},{id:6,name:"Chuquisaca"},{id:7,name:"Potos\xed"},{id:8,name:"Oruro"},{id:9,name:"Tarija"}],this.optionsCity=[{id:1,name:"Montero"},{id:2,name:"Santa Cruz de la Sierra"},{id:3,name:"Warnes"},{id:4,name:"Cotoca"},{id:5,name:"La Guardia"},{id:6,name:"Puerto Su\xe1rez"},{id:7,name:"San Ignacio de Velasco"},{id:8,name:"Concepci\xf3n"},{id:9,name:"Robor\xe9"},{id:10,name:"Saavedra"},{id:11,name:"Bajo Paragu\xe1"},{id:12,name:"Ascensi\xf3n de Guarayos"},{id:13,name:"San Jos\xe9 de Chiquitos"},{id:14,name:"Carmen Rivero T\xf3rrez"},{id:15,name:"El Torno"},{id:16,name:"Yapacan\xed"},{id:17,name:"Guarayos"},{id:18,name:"Minero"}],this.optionsGender=[{id:1,name:"Hombre"},{id:2,name:"Mujer"}],this.hasLink=!1,this.currentClient=null,this.prop=["id","firstName","lastName","phone","ci","nit","photo","ubication","company","latitude","longitude","reference","link"],this.isModal=u,this.form=this.fb.group({id:[null],firstName:[null,[s.kI.required,s.kI.minLength(3)]],lastName:[null],phone:[null,[s.kI.required,s.kI.minLength(7)]],ci:[null],nit:[null],photo:[null],ubication:[null],clientZoneId:[1,null],departamentId:[1],cityId:[1],genderId:[1],company:[null],latitude:[null],longitude:[null],reference:[null],link:[null]})}ngOnInit(){this.isCreate=this.router.url.endsWith("/store"),this.isCreate?this.isCreate=!0:(this.isCreate=!1,this.id=parseInt(this.activatedRoute.snapshot.params.id),this.service.getById(this.id).subscribe(o=>{this.currentClient=o,this.prop.forEach(t=>{"photo"===t?this.processPhoto(o[t]):this.form.get(t)?.setValue(o[t]),"link"===t&&(this.hasLink=null!==o[t])}),this.loadCoordsMap()}))}loadCoordsMap(){var o=this;return(0,d.Z)(function*(){o.geoService.getCurrentLocation().then(t=>{if(null!=o.currentClient.latitude){const n=o.currentClient.latitude,i=o.currentClient.longitude;"number"==typeof n&&"number"==typeof i?setTimeout(()=>{const c=o.googleMap.googleMap,l={lat:n,lng:i};o.center={lat:l.lat,lng:l.lng},o.form.get("latitude").setValue(l.lat),o.form.get("longitude").setValue(l.lng),o.form.get("link").setValue(`https://www.google.com/maps?q=${l.lat},${l.lng}`),o.movableMarker=new google.maps.Marker({position:l,map:c,draggable:!0}),google.maps.event.addListener(o.movableMarker,"dragend",u=>o.onMarkerDragEnd(u))},100):console.error("Coordenadas inv\xe1lidas:",n,i)}else{const n=t.coords.latitude,i=t.coords.longitude;"number"==typeof n&&"number"==typeof i?setTimeout(()=>{const c=o.googleMap.googleMap,l={lat:n,lng:i};o.center={lat:l.lat,lng:l.lng},o.form.get("latitude").setValue(l.lat),o.form.get("longitude").setValue(l.lng),o.form.get("link").setValue(`https://www.google.com/maps?q=${l.lat},${l.lng}`),o.movableMarker=new google.maps.Marker({position:l,map:c,draggable:!0}),google.maps.event.addListener(o.movableMarker,"dragend",u=>o.onMarkerDragEnd(u))},100):console.error("Coordenadas inv\xe1lidas:",n,i)}}).catch(t=>{console.error("Error al obtener ubicaci\xf3n:",t)})})()}getLatitude(){var o=this;return(0,d.Z)(function*(){if(!o.isCreate&&o.currentClient.latitude)return o.currentClient.latitude;try{return(yield o.geoService.getCurrentLocation()).coords.latitude}catch(t){return console.error("Error al obtener ubicaci\xf3n:",t),-17.7836996}})()}getLongitude(){var o=this;return(0,d.Z)(function*(){if(!o.isCreate&&o.currentClient.longitude)return o.currentClient.longitude;try{return(yield o.geoService.getCurrentLocation()).coords.longitude}catch(t){return console.error("Error al obtener ubicaci\xf3n:",t),-63.1826825}})()}ngAfterViewInit(){var o=this;return(0,d.Z)(function*(){o.isCreate&&o.geoService.getCurrentLocation().then(t=>{const n=t.coords.latitude,i=t.coords.longitude;"number"==typeof n&&"number"==typeof i?setTimeout(()=>{const c=o.googleMap.googleMap,l={lat:n,lng:i};o.center={lat:l.lat,lng:l.lng},o.form.get("latitude").setValue(l.lat),o.form.get("longitude").setValue(l.lng),o.form.get("link").setValue(`https://www.google.com/maps?q=${l.lat},${l.lng}`),o.movableMarker=new google.maps.Marker({position:l,map:c,draggable:!0}),google.maps.event.addListener(o.movableMarker,"dragend",u=>o.onMarkerDragEnd(u))},100):console.error("Coordenadas inv\xe1lidas:",n,i)}).catch(t=>{console.error("Error al obtener ubicaci\xf3n:",t)})})()}getLocation(){window.open(this.currentClient.link,"_blank")}onMarkerDragEnd(o){const t=o.latLng;if(t){const n=t.lat(),i=t.lng();if(isNaN(n)||isNaN(i))return void console.error("Coordenadas inv\xe1lidas");this.form.get("latitude")?.setValue(n),this.form.get("longitude")?.setValue(i),this.form.get("link")?.setValue(`https://www.google.com/maps?q=${n},${i}`)}else console.error("La nueva posici\xf3n no es v\xe1lida")}get formLabel(){return this.isCreate?"Reg\xedstro":"Actualizaci\xf3n"}control(o){return this.form.controls[o]}processPhoto(o){if(null!=o){const t="data:image/png;base64,"+o;this.form.get("photo")?.setValue(t),this.imageSource=t}else{const t="https://img.freepik.com/psd-gratis/3d-ilustracion-persona-gafas-sol_23-2149436188.jpg?size=338&ext=jpg&ga=GA1.1.1788068356.1716681600&semt=ais_user";this.form.get("photo")?.setValue(t),this.imageSource=t}}setListZone(){this.service.getListZone().subscribe(o=>{this.listZone=o})}getPanelState(){console.log("Panel est\xe1",this.panel.expanded?"abierto":"cerrado")}uploadAvatar(o){var t=this;return(0,d.Z)(function*(){if(!o.length)return;const i=o[0],c=new FileReader;c.readAsDataURL(i),c.onload=()=>{t.setPhoto(c.result)}})()}setPhoto(o){var t=this;return(0,d.Z)(function*(){t.imageSource=t.sanitizer.bypassSecurityTrustResourceUrl(o),t.form.get("photo").setValue(o)})()}removeAvatar(){this.imageSource=this.sanitizer.bypassSecurityTrustResourceUrl(h.B),this.form.get("photo").setValue(null)}closeModal(o){this.dialogRef.close(o)}cancel(){this.isModal?this.dialogRef.close(!1):this.router.navigate(["client/client"])}save(){let o=this.isCreate?"Registro":"Actualizaci\xf3n";if(this.isValidForm()){let t=this.form.value,n=t.photo;null!=n&&n.startsWith("https://")&&(t.photo=null),t.id=this.id,this.isSaving=!0,this.service.store(t).subscribe(i=>{g().fire({position:"top-end",icon:"success",title:"Su "+o+"se realizo con exito!",showConfirmButton:!1,timer:1500}),this.isModal?this.closeModal(i):this.router.navigate(["client/client"])})}}isValidForm(){return Object.keys(this.form.controls).forEach(t=>{this.form.get(t)?.markAsTouched({onlySelf:!0})}),this.form.valid}}p.\u0275fac=function(o){return new(o||p)(e.Y36(C.gz),e.Y36(s.qu),e.Y36(C.F0),e.Y36(L.H7),e.Y36(A.y),e.Y36(O._),e.Y36(m.WI,8),e.Y36(m.so,8))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-store-client"]],viewQuery:function(o,t){if(1&o&&(e.Gf(P.b6,5),e.Gf(U,5)),2&o){let n;e.iGM(n=e.CRH())&&(t.googleMap=n.first),e.iGM(n=e.CRH())&&(t.panel=n.first)}},decls:64,vars:92,consts:[[1,"father"],[1,"contenido"],[1,"pd-20","card-box"],[1,""],[1,"w-full","mt-4"],["class","text-2xl font-semibold tracking-tight leading-6",4,"ngIf"],[1,"font-medium","tracking-tight","text-secondary"],["ngNativeValidate","","autocomplete","off",3,"formGroup"],[1,"flex","items-center","justify-center"],["alt","Image Source",1,"image",3,"src"],[1,"flex","items-center","justify-center","mt-1"],[1,"flex","items-center","justify-center",2,"width","200px"],[1,"flex","items-center","justify-center","bg-primary-500","p-1",2,"border-radius","5px","width","100%"],["id","avatar-file-input","type","file",1,"absolute","h-0","w-0","opacity-0","invisible","pointer-events-none",3,"multiple","accept","change"],["avatarFileInput",""],["for","avatar-file-input","matRipple","",1,"flex","items-center","justify-center","w-10","h-10","rounded-full","cursor-pointer","hover:bg-hover"],[1,"text-white",3,"svgIcon"],[1,"flex","items-center","justify-center","bg-gray-300","p-1",2,"border-radius","5px","width","100%","height","48px",3,"click"],[2,"display","flex","justify-content","center","justify-items","center"],["class","mt-2 mr-2",3,"color","label","icon","withFull","disabled","buttonClick",4,"ngIf"],[1,"grid","sm:grid-cols-2","md:grid-cols-4","gap-6","w-full","mt-8"],[3,"formControl","label","maxLength","minLength","icon","disabled","placeholder"],[1,"w-full"],[3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],[1,"grid","sm:grid-cols-2","md:grid-cols-4","gap-6","w-full","mt-2"],[1,"flex","items-center","justify-between","px-8","py-5","dark:bg-gray-700"],[2,"display","flex"],[1,"px-6","ml-3",3,"color","label","icon","withFull","disabled","buttonClick"],[1,"",3,"color","label","icon","withFull","disabled","buttonClick"],[1,"text-2xl","font-semibold","tracking-tight","leading-6"],[1,"mt-2","mr-2",3,"color","label","icon","withFull","disabled","buttonClick"],[3,"value"]],template:function(o,t){if(1&o){const n=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",3)(5,"div",4),e.YNc(6,R,2,0,"div",5),e.YNc(7,w,2,0,"div",5),e.TgZ(8,"div",6),e._uU(9,"Modulo de gestiones para clientes"),e.qZA()(),e._UZ(10,"br")(11,"hr"),e.TgZ(12,"form",7)(13,"div")(14,"div",8),e._UZ(15,"img",9),e.qZA(),e.TgZ(16,"div",10)(17,"div",11)(18,"div",12)(19,"input",13,14),e.NdJ("change",function(){e.CHM(n);const c=e.MAs(20);return e.KtG(t.uploadAvatar(c.files))}),e.qZA(),e.TgZ(21,"label",15),e._UZ(22,"mat-icon",16),e.qZA()(),e.TgZ(23,"div",17),e.NdJ("click",function(){return t.removeAvatar()}),e._UZ(24,"mat-icon",16),e.qZA()()(),e.TgZ(25,"div",18),e.YNc(26,k,1,5,"btn-actions",19),e.qZA()(),e.TgZ(27,"div",20)(28,"div"),e._UZ(29,"input-text",21),e.qZA(),e.TgZ(30,"div"),e._UZ(31,"input-text",21),e.qZA()(),e.TgZ(32,"div",20)(33,"div"),e._UZ(34,"input-text",21),e.qZA(),e.TgZ(35,"div"),e._UZ(36,"input-text",21),e.qZA()(),e.TgZ(37,"div",20)(38,"div"),e._UZ(39,"input-text",21),e.qZA(),e.TgZ(40,"div")(41,"mat-form-field",22)(42,"mat-label"),e._uU(43,"Departamento"),e.qZA(),e.TgZ(44,"mat-select",23),e.YNc(45,J,2,2,"mat-option",24),e.qZA()()()(),e.TgZ(46,"div",25)(47,"div")(48,"mat-form-field",22)(49,"mat-label"),e._uU(50,"Ciudad"),e.qZA(),e.TgZ(51,"mat-select",23),e.YNc(52,N,2,2,"mat-option",24),e.qZA()()(),e.TgZ(53,"div")(54,"mat-form-field",22)(55,"mat-label"),e._uU(56,"Genero"),e.qZA(),e.TgZ(57,"mat-select",23),e.YNc(58,B,2,2,"mat-option",24),e.qZA()()()(),e.TgZ(59,"div",26),e._UZ(60,"div"),e.TgZ(61,"div",27)(62,"btn-generic",28),e.NdJ("buttonClick",function(){return t.cancel()}),e.qZA(),e.TgZ(63,"btn-generic",29),e.NdJ("buttonClick",function(){return t.save()}),e.qZA()()()()()()()()()}2&o&&(e.xp6(6),e.Q6J("ngIf",t.isCreate),e.xp6(1),e.Q6J("ngIf",!t.isCreate),e.xp6(5),e.Q6J("formGroup",t.form),e.xp6(3),e.Q6J("src",t.imageSource,e.LSH),e.xp6(4),e.Q6J("multiple",!1)("accept","image/jpeg, image/png"),e.xp6(3),e.Q6J("svgIcon","heroicons_outline:camera"),e.xp6(2),e.Q6J("svgIcon","heroicons_outline:trash"),e.xp6(2),e.Q6J("ngIf",t.hasLink),e.xp6(2),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(1),e.Q6J("formControl",t.control("firstName"))("label","Nombres:")("maxLength",50)("minLength",3)("icon","heroicons_outline:user-circle")("disabled",!1)("placeholder","Nombres.."),e.xp6(1),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(1),e.Q6J("formControl",t.control("lastName"))("label","Apellidos:")("maxLength",50)("minLength",3)("icon","heroicons_outline:user-circle")("disabled",!1)("placeholder","Apellido.."),e.xp6(2),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(1),e.Q6J("formControl",t.control("phone"))("label","Celular:")("maxLength",50)("minLength",3)("icon","heroicons_outline:phone")("disabled",!1)("placeholder","Celular.."),e.xp6(1),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(1),e.Q6J("formControl",t.control("ci"))("label","Carnet:")("maxLength",50)("minLength",3)("icon","heroicons_outline:identification")("disabled",!1)("placeholder","Carnet.."),e.xp6(2),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(1),e.Q6J("formControl",t.control("nit"))("label","N\xb0 Nit:")("maxLength",50)("minLength",3)("icon","heroicons_solid:briefcase")("disabled",!1)("placeholder","N\xb0 Nit.."),e.xp6(1),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(4),e.Q6J("formControlName","departamentId"),e.xp6(1),e.Q6J("ngForOf",t.listDepartament),e.xp6(2),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(4),e.Q6J("formControlName","cityId"),e.xp6(1),e.Q6J("ngForOf",t.optionsCity),e.xp6(1),e.ekj("sm:col-span-2",!t.isModal)("sm:col-span-4",t.isModal),e.xp6(4),e.Q6J("formControlName","genderId"),e.xp6(1),e.Q6J("ngForOf",t.optionsGender),e.xp6(4),e.Q6J("color","secondary")("label"," Cancelar")("icon","close")("withFull",!1)("disabled",!1),e.xp6(1),e.Q6J("color","green")("label"," Guardar")("icon","save")("withFull",!1)("disabled",t.isSaving))},dependencies:[v.sg,v.O5,s.JJ,s.JL,x.Hw,s.oH,s.sg,s.u,b.KE,b.hX,M.wG,y.gD,M.ey,D.m,I.e,S.P],styles:[".icon[_ngcontent-%COMP%]{margin:0 10px;color:#000;font-weight:900}.contenido[_ngcontent-%COMP%]{width:100%;height:100%;padding:20px;border-radius:5px;background:#fff;transition:all .3s ease-in-out;box-shadow:0 0 25px #0000001a}.father[_ngcontent-%COMP%]{padding:8px;width:100%;height:100%}.image[_ngcontent-%COMP%]{box-shadow:0 0 25px #0000001a;height:200px;width:200px;border:7px solid #BFC9CA;border-radius:5px}"]})},6682:(E,f,a)=>{a.d(f,{_:()=>s});var d=a(4650);class s{constructor(){}getCurrentLocation(){return new Promise((m,_)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(g=>m(g),g=>_(g)):_(new Error("Geolocation is not supported by this browser."))})}}s.\u0275fac=function(m){return new(m||s)},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}}]);